---
title: Traces
description: Group multiple logs into a single trace to debug, monitor, and analyze your application.
icon: arrow-progress
---

<Frame type="glass">
![Sample Trace](/assets/trace/sample.png)
</Frame>

## Explanation

Traces allow you to group multiple logs together to easily debug, monitor, and analyze your application's flow.

By organizing related logs into a single trace, you can better understand how a request moves through your system, identify performance bottlenecks, and quickly pinpoint errors.

Traces are currently supported in logging and experiments.

## Basic

To create a trace, use the `trace` method on a Montelo instance. This returns a new `Trace` instance for you to use.

```typescript
const chat = async (topic: string): Promise<void> => {
  const trace = montelo.trace({ name: "Example Trace" });

  await trace.log({ name: "Vector DB", input: { topic } });
  await trace.openai.chat.completions.create({
    name: "Short Joke",
    model: "gpt-3.5-turbo",
    messages: [{ role: "user", content: `Tell me a short joke about ${topic}` }],
  });
  await trace.mistral.chat({
    name: "Lame joke",
    model: "mistral-tiny",
    messages: [{ role: "user", content: `Tell me a lame joke ${topic}` }],
  });
};

void chat("Football");
```

All logs generated within the trace instance will be grouped together in the "Example Trace".

![Basic Trace](/assets/trace/basic.png)

<Note>These logs will be added to the trace with no hierarchy. For hierarchical traces, see `Nesting` below.</Note>

## Nesting with Spans

You can nest logs within a trace using spans.

```typescript
const trace = montelo.trace({ name: "Sample Trace" });

const span = await trace.span({ name: "Span - 1" });
await span.log({ name: "Log - 1.1" });
await span.log({ name: "Log - 1.2" });

const nestedSpan = await span.span({ name: "Nested Span - 1.3" });
await nestedSpan.log({ name: "Log - 1.3.1" });
await nestedSpan.log({ name: "Log - 1.3.2" });

await span.log({ name: "Log - 1.4" });

await trace.log({ name: "Log - 2" });
```

{/* TODO should figure out if we support this */}
{/* Distributed */}

## In Experiments

Traces also work in experiments, so that each run in the `runner` is enclosed in a trace.

Take this experiment for example:

```typescript
const chat = async (topic: string): Promise<string> => {
  const trace = montelo.trace({ name: "Example Trace" });

  await trace.log({ name: "Vector DB", input: { topic } });
  await trace.openai.chat.completions.create({
    name: "Short Joke",
    model: "gpt-3.5-turbo",
    messages: [{ role: "user", content: `Tell me a short joke about ${topic}` }],
  });
  const result = await trace.mistral.chat({
    name: "Lame joke",
    model: "mistral-tiny",
    messages: [{ role: "user", content: `Tell me a lame joke ${topic}` }],
  });

  return result.choices[0].message.content;
};


await montelo.experiments.createAndRun({
  name: "Example Experiment",
  dataset: dataset.slug,
  runner: async ({ input }) => {
    const joke = await chat(input.topic);
    return { joke }
  },
  evaluator: async () => {
    return {
      isFunny: "yes"
    }
  },
});
```

The code above will create the following two distinct traces to help you analyze and debug.

<video
  muted
  autoPlay
  loop
  playsInline
  className="w-full aspect-video"
  src="/assets/trace/trace_experiment.mp4"
></video>
